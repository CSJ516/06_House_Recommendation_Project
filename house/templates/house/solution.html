{% block content %}
    
{% include 'home.html' %}

<!-- <div id="map" style="width:100%;height:500px;"></div> -->
<!-- <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=66b844040bca20e5883ec6ced3f59ede"></script> -->
<div id="mapwrap"> 
    <!-- 지도가 표시될 div -->
    <div id="map" style="width:100%;height:500px;"></div>
    <!-- 지도 위에 표시될 마커 카테고리 -->
    <div class="category">
        <ul>
            <li id="houseMenu" onclick="changeMarker('house')">
                <span class="ico_comm ico_house"></span>
                부동산
            </li>
            <li id="storeMenu" onclick="changeMarker('store')">
                <span class="ico_comm ico_store"></span>
                편의점
            </li>
            <li id="carparkMenu" onclick="changeMarker('carpark')">
                <span class="ico_comm ico_carpark"></span>
                주차장
            </li>
        </ul>
    </div>
</div>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=66b844040bca20e5883ec6ced3f59ede"></script>

{% comment %} 부동산 위도,경도 {% endcomment %}
<div id="facility_lat" style="display: none">
    {% for fac in solution %}
        {{ fac.latitude }},
    {% endfor %}
</div>
<div id="facility_lng" style="display: none">
    {% for fac in solution %}
        {{ fac.longitude }},
    {% endfor %}
</div>

<script>
// <script type="text/javascript">
var list_lat = document.getElementById("facility_lat").innerText.split(',');
var list_lng = document.getElementById("facility_lng").innerText.split(',');
var housePositions = new Array();
for(var idx=0; idx<list_lat.length; idx++){
    // var data = list[idx];
    var data_lat = list_lat[idx];
    var data_lng = list_lng[idx];
    // housePositions.push(new kakao.maps.LatLng(data.위도, data.경도));
    housePositions.push(new kakao.maps.LatLng(data_lat, data_lng));
}
var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
    mapOption = { 
        center: new kakao.maps.LatLng({{job_1}}, {{job_2}}), // 지도의 중심좌표 
        level: 3 // 지도의 확대 레벨 
    }; 
var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
// 부동산 마커가 표시될 좌표 배열입니다
var markerImageSrc = 'https://postfiles.pstatic.net/MjAyMDEwMjNfNzkg/MDAxNjAzNDQxMTc5NDQ4.SWSVcM-uLk3cwhy4KO4nI9RwL1dwszjxd0wzRmEZQCkg.rP2t_ejqGeoTGjHK0ONS9mdDv3MqaZ8oUk4Q5Md1Jz0g.PNG.snrnrp2004/%EC%BA%A1%EC%B2%98-removebg-preview.png?type=w773';  // 마커이미지의 주소입니다. 스프라이트 이미지 입니다
    houseMarkers = [], // 부동산 마커 객체를 가지고 있을 배열입니다
createhouseMarkers(); // 부동산 마커를 생성하고 부동산 마커 배열에 추가합니다
changeMarker('house'); // 지도에 부동산 마커가 보이도록 설정합니다    
// 마커이미지의 주소와, 크기, 옵션으로 마커 이미지를 생성하여 리턴하는 함수입니다
function createMarkerImage(src, size, options) {
    var markerImage = new kakao.maps.MarkerImage(src, size, options);
    return markerImage;            
}
// 좌표와 마커이미지를 받아 마커를 생성하여 리턴하는 함수입니다
function createMarker(position, image) {
    var marker = new kakao.maps.Marker({
        position: position,
        image: image
    });
    return marker;  
}   
// 부동산 마커를 생성하고 부동산 마커 배열에 추가하는 함수입니다
function createhouseMarkers() {
    for (var i = 0; i < housePositions.length; i++) {  
        var imageSize = new kakao.maps.Size(100, 100),
            imageOptions = {  
                spriteOrigin: new kakao.maps.Point(10,0),    
                spriteSize: new kakao.maps.Size(36,98)  
            };     
        // 마커이미지와 마커를 생성합니다
        var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),    
            marker = createMarker(housePositions[i], markerImage);  
        // 생성된 마커를 부동산 마커 배열에 추가합니다
        houseMarkers.push(marker);
    }     
}
// 부동산 마커들의 지도 표시 여부를 설정하는 함수입니다
function sethouseMarkers(map) {        
    for (var i = 0; i < houseMarkers.length; i++) {  
        houseMarkers[i].setMap(map);
    }        
}
// 편의점 마커를 생성하고 편의점 마커 배열에 추가하는 함수입니다
function createStoreMarkers() {
    for (var i = 0; i < storePositions.length; i++) {
        var imageSize = new kakao.maps.Size(22, 26),
            imageOptions = {   
                spriteOrigin: new kakao.maps.Point(10, 36),    
                spriteSize: new kakao.maps.Size(36, 98)  
            };       
        // 마커이미지와 마커를 생성합니다
        var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),    
            marker = createMarker(storePositions[i], markerImage);  
        // 생성된 마커를 편의점 마커 배열에 추가합니다
        storeMarkers.push(marker);    
    }        
}
// 편의점 마커들의 지도 표시 여부를 설정하는 함수입니다
function setStoreMarkers(map) {        
    for (var i = 0; i < storeMarkers.length; i++) {  
        storeMarkers[i].setMap(map);
    }        
}
// 주차장 마커를 생성하고 주차장 마커 배열에 추가하는 함수입니다
function createCarparkMarkers() {
    for (var i = 0; i < carparkPositions.length; i++) {
        var imageSize = new kakao.maps.Size(22, 26),
            imageOptions = {   
                spriteOrigin: new kakao.maps.Point(10, 72),    
                spriteSize: new kakao.maps.Size(36, 98)  
            };       
        // 마커이미지와 마커를 생성합니다
        var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),    
            marker = createMarker(carparkPositions[i], markerImage);  
        // 생성된 마커를 주차장 마커 배열에 추가합니다
        carparkMarkers.push(marker);        
    }                
}
// 주차장 마커들의 지도 표시 여부를 설정하는 함수입니다
function setCarparkMarkers(map) {        
    for (var i = 0; i < carparkMarkers.length; i++) {  
        carparkMarkers[i].setMap(map);
    }        
}
// 카테고리를 클릭했을 때 type에 따라 카테고리의 스타일과 지도에 표시되는 마커를 변경합니다
function changeMarker(type){
    var houseMenu = document.getElementById('houseMenu');
    var storeMenu = document.getElementById('storeMenu');
    var carparkMenu = document.getElementById('carparkMenu');
    // 부동산 카테고리가 클릭됐을 때
    if (type === 'house') {
        // 부동산 카테고리를 선택된 스타일로 변경하고
        houseMenu.className = 'menu_selected';
        // 편의점과 주차장 카테고리는 선택되지 않은 스타일로 바꿉니다
        storeMenu.className = '';
        carparkMenu.className = '';
        // 부동산 마커들만 지도에 표시하도록 설정합니다
        sethouseMarkers(map);
        setStoreMarkers(null);
        setCarparkMarkers(null);
} else if (type === 'store') { // 편의점 카테고리가 클릭됐을 때
    // 편의점 카테고리를 선택된 스타일로 변경하고
    houseMenu.className = '';
    storeMenu.className = 'menu_selected';
    carparkMenu.className = '';
    // 편의점 마커들만 지도에 표시하도록 설정합니다
    sethouseMarkers(null);
    setStoreMarkers(map);
    setCarparkMarkers(null);
} else if (type === 'carpark') { // 주차장 카테고리가 클릭됐을 때
    // 주차장 카테고리를 선택된 스타일로 변경하고
    houseMenu.className = '';
    storeMenu.className = '';
    carparkMenu.className = 'menu_selected';
    // 주차장 마커들만 지도에 표시하도록 설정합니다
    sethouseMarkers(null);
    setStoreMarkers(null);
    setCarparkMarkers(map);  
}    
} 
</script>

<div>
    <h1>검색결과</h1>
    <table class = 'table'>
        <thead>
            <tr>
                <th>주소</th>
                <th>전월세</th>
                <th>보증금</th>
                <th>세</th>
                <th>거래년도</th>
                <th>면적</th>            
                <th>위도</th>
                <th>경도</th>
            </tr>
        </thead>
        <tbody>
            {% for info in solution %}
                <tr>
                    <td>
                    <!-- <span onclick='req("{{info.criteria}}", "{{t1}}");location.href="{% url 'home' %}"'>{{info.address}}</span>  -->
                    <span onclick='req("{{info.criteria}}", "{{t1}}")'>{{info.address}}</span> 
                    </td>
                    <td>{{info.rent}}</td>
                    <td>{{info.deposit}}</td>
                    <td>{{info.pay}}</td>
                    <td>{{info.contract}}</td>
                    <td>{{info.size}}</td>
                    <td>{{info.latitude}}</td>
                    <td>{{info.longitude}}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
                
{{job1}}
{{job2}}
<input type='hidden' id="tableName" value='{{t1}}'>

<div id = 'dataView'>
    {% if con_detail_0 %}
        {% for de0 in con_detail_0 %}
        <tr>
            <td>{{de0.con_name}}</td>
            <td>{{de0.con_addres}}</td>
            <td>{{de0.con_latitu}}</td>
            <td>{{de0.con_longit}}</td>
        </tr>
        {% endfor %}
    {% endif %}
    {% if con_detail_1 %}
        {% for de1 in con_detail_1 %}
        <tr>
            <td>{{de1.con_name}}</td>
            <td>{{de1.con_addres}}</td>
            <td>{{de1.con_latitu}}</td>
            <td>{{de1.con_longit}}</td>
        </tr>
        {% endfor %}
    {% endif %}

    {% if con_detail_2 %}
        {% for de2 in con_detail_2 %}
        <tr>
            <td>{{de2.con_name}}</td>
            <td>{{de2.con_addres}}</td>
            <td>{{de2.con_latitu}}</td>
            <td>{{de2.con_longit}}</td>
        </tr>
        {% endfor %}
    {% endif %}

</div>


<script>
    function req(v1, v2){
        // alert(document.getElementById('tableName').value);
    // }
    // function loadDoc() {
        var xhttp = new XMLHttpRequest();
        console.log(1);
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                console.log(this.responseText);
                document.getElementById("dataView").innerHTML = this.responseText; 
            }
        };
        console.log(2);
        // xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        // criteria = document.getElementById('criteria').value;
        // tableName = document.getElementById('tableName').value;
        xhttp.open("GET", "detail?criteria="+v1 + "&tableName="+v2, true);
        console.log(3);
        xhttp.send();
    }
    
</script>


{% endblock content %}
